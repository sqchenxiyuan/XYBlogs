# JS监控DOM大小的变化

由于浏览器原生不自带DOM元素的resize事件，一直想弄一个JS监控DOM元素大小变化的功能，之前想过很多方法都各有优缺点，但是最近发现了一个很不错的方法，虽然以前有设想过但一直没有时间去实现，知道看到有人根据我的设想实现了一种比较优良的监听方法，这篇文章将会列举一下过去想到的一些方法，以及这个最近理解完成的方法~~~

## DOM大小的变化的诱因

### DOM大小的决定因素

在寻找如何监听DOM大小变化的解决办法之前，这里先列举DOM元素宽高的数值的情况：

1.  自己设置的固定宽高，如样式设置`style="width:100px;height:100px"`
2.  由上层元素决定，如样式设置`style="width:50%;height:50%"`
3.  有下层元素决定，内容撑大

宽高各自独立，可以混合出现

### DOM大小改变的原因

知道了决定的DOM大小的因素的3种情况，可以很快的列出大部分导致DOM大小变化的情况：

1.  元素修改自己的宽高样式

    元素修改自己的宽高属性，是最简单最直接也是最常见的DOM大小变化的情况

2.  当元素大小由上层元素(包括窗口大小)决定，上层元素大小发生变动时
3.  当袁术大小由下层元素决定，下层元素大小发生变动时

上面三种是最常见也是最容易想到的，仔细思考还存在其他情况

4.  元素的class的内容改变

    当元素的class的内容的宽高变化时，元素是不能监听到class内容变化的，虽然这个操作很不好，但是在切换页面皮肤时确实可能存在这样的问题

5.  过渡/动画

    当元素设置了过渡/动画效果时，元素的宽高是可能在每一帧的出现变化的

这些因素也是最难以监听和获取的可以叫"隐式变化"，之前3个比较简单的变化由于可以在节点树上和style上明显看出变化，可以简单叫"显式变化"

**显式变化**可以通过`MutationObserver`监听来达到事件流驱动节约性能的效果，但是**隐式变化**也是同样需要检测出来的，下面将列举两个检测办法，都各自有优缺点

## 解决办法

### 循环比对

最最简单直接有效的方法当然是每一帧去计算和比对需要监听的DOM的大小是否发生改变

``



## 参考资料

[](https://www.w3.org/TR/cssom-view-1/#scrolling)
[](https://blog.crimx.com/2017/07/15/element-onresize/)

## END

>   2018-10-17   立项