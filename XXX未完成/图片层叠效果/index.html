<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style media="screen">
        html,body{
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
        }

        img{
            position: fixed;
            /*filter: blur(2px);*/
            /*transition: left .5s, top .5s;*/
        }

        div.test1{
            position: fixed;
            /*width: 100%;
            height: 100%;*/
            width: 100px;
            height: 100px;
            left: 0;
            bottom: 0;
            border: 1px black solid;
        }
    </style>
</head>
<body>
    <img id="test"  src="test.jpg" alt="">
    <div></div>
    <div id="test-div" class="test1"></div>
</body>
<script>
    let sx = 0.1;
    let sy = 0.1;

    let img = document.getElementById("test");
    console.log(img.clientWidth,img.clientHeight)
    let c = new Image();
    c.src = img.src;
    let imgh,imgw;
    c.onload = () => {
        imgh = c.height;
        imgw = c.width;
    }

    let centerPoint = {x:0.5, y:0.5};

    // document.addEventListener('mousemove',function(e){
    //     let x = e.clientX;
    //     let y = e.clientY;
    //
    //     let cw = window.innerWidth;
    //     let ch = window.innerHeight;
    //
    //     let viewh = ch / (1 - sy);
    //     let vieww = cw / (1 - sx);
    //
    //     let imgW,imgH;
    //     console.log(viewh, vieww)
    //     if(vieww / viewh > imgw / imgh){
    //
    //         imgW = vieww;
    //         imgH = imgh * vieww / imgw;
    //
    //     } else {
    //
    //         imgW = imgw * viewh / imgh;
    //         imgH = viewh;
    //
    //     }
    //     console.log(imgH, imgW)
    //     img.width = imgW;
    //     img.height = imgH;
    //
    //
    //
    //     let px = x / cw;//进度
    //     let py = y / ch;
    //
    //
    //
    //     // img.style.left = `-${sx * px * 100}%`
    //     // img.style.top = `-${sy * py * 100}%`
    //
    //     //强制
    //     img.style.left = `-${(imgW / 2 - vieww / 2) + vieww * sx * px}px`
    //     img.style.top = `-${(imgH / 2 - viewh / 2) + viewh * sy * py}px`
    // })

    // document.getElementById('test-div').addEventListener('mousemove',function(e){
    //     let x = e.offsetX;
    //     let y = e.offsetY;
    //
    //     let controlw = this.clientWidth;
    //     let controlh = this.clientHeight;
    //     console.log(img.parentElement.clientWidth)
    //
    //
    //
    //     let cw = window.innerWidth;
    //     let ch = window.innerHeight;
    //
    //     let px = x / controlw;//进度
    //     let py = y / controlh;
    //
    //     let viewh = ch / (1 - sy);
    //     let vieww = cw / (1 - sx);
    //
    //     let imgW,imgH;
    //     if(vieww / viewh > imgw / imgh){
    //
    //         imgW = vieww;
    //         imgH = imgh * vieww / imgw;
    //
    //     } else {
    //
    //         imgW = imgw * viewh / imgh;
    //         imgH = viewh;
    //
    //     }
    //     img.style.width = imgW+'px';
    //     img.style.height = imgH+'px';
    //
    //
    //
    //
    //
    //     console.log(px,py)
    //     // img.style.left = `-${sx * px * 100}%`
    //     // img.style.top = `-${sy * py * 100}%`
    //
    //     //强制
    //     img.style.left = `-${(imgW / 2 - vieww / 2) + vieww * sx * px}px`
    //     img.style.top = `-${(imgH / 2 - viewh / 2) + viewh * sy * py}px`
    // })

    class ImageProspect{
        constructor(controlDom,showDom,w,h){
            this.controlDom = controlDom;
            this.showDom = showDom;

            this.showW = w;
            this.showH = h;
            controlDom.addEventListener('mousemove',this.move.bind(this))
        }

        move(e){
            let containerDom = this.showDom.offsetElement || document.body;


            //计算当前进度
            let x = e.offsetX;
            let y = e.offsetY;

            let controlw = this.controlDom.clientWidth || document.body.clientWidth;
            let controlh = this.controlDom.clientHeight || document.body.clientHeight;
            let px = x / controlw;//进度
            let py = y / controlh;
            if(px > 1) px = 1;
            if(px < 0) px = 0;
            if(py > 1) py = 1;
            if(py < 0) py = 0;

            //完全区域大小
            let cw = containerDom.clientWidth;
            let ch = containerDom.clientHeight;

            let viewh = ch / (1 - sy);
            let vieww = cw / (1 - sx);


            //设置远景大小
            let imgW,imgH;

            let imgh = this.showH;
            let imgw = this.showW;

            if(vieww / viewh > imgw / imgh){
                imgW = vieww;
                imgH = imgh * vieww / imgw;
            } else {
                imgW = imgw * viewh / imgh;
                imgH = viewh;
            }

            this.showDom.style.width = imgW+'px';
            this.showDom.style.height = imgH+'px';


            console.log(imgW,vieww,sx,px)
            img.style.left = `-${(imgW / 2 - vieww / 2) + vieww * sx * px}px`
            img.style.top = `-${(imgH / 2 - viewh / 2) + viewh * sy * py}px`
        }
    }

    new ImageProspect(document,document.getElementById("test"),1680,1050)
    // new ImageProspect(document.getElementById("test-div"),document.getElementById("test"),1680,1050)

</script>
</html>
